!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e(t.UM=t.UM||{},t.THREE)}(this,function(t,e){"use strict";function i(t,e,i,o,r,n){function s(t,e){var i=t[0],o=t[1],r=t[2];return[e[0]*i+e[1]*o+e[2]*r,e[4]*o+e[5]*r,e[8]*r]}if(t<=0||e<=0||i<=0||o<=0||r<=0||n<=0)throw Error("Zero or negative unit cell parameter(s).");this.parameters=[t,e,i,o,r,n];var a=Math.PI/180,l=Math.cos(a*o),h=Math.cos(a*r),c=Math.cos(a*n),d=Math.sin(a*o),u=Math.sin(a*r),f=Math.sin(a*n);if(0===d||0===u||0===f)throw Error("Impossible angle - N*180deg.");var _=(h*c-l)/f,p=_/u,m=Math.sqrt(1-p*p),v=[t,e*c,i*h,0,e*f,-i*_,0,0,i*u*m],g=[1/t,-c/(f*t),-(c*_+h*f)/(u*m*f*t),0,1/(f*e),p/(m*f*e),0,0,1/(u*m*i)];this.fractionalize=function(t){return s(t,g)},this.orthogonalize=function(t){return s(t,v)}}function o(){this.atoms=[],this.unit_cell=null,this.space_group=null,this.has_hydrogens=!1,this.lower_bound=null,this.upper_bound=null}function r(){this.hetero=!1,this.name="",this.altloc="",this.resname="",this.chain="",this.chain_index=null,this.resseq=null,this.icode=null,this.xyz=[0,0,0],this.occ=1,this.b=0,this.element="",this.charge=0,this.i_seq=null,this.is_ligand=null,this.bonds=[]}function n(t,e,i,o){var r;this.boxes=[],this.xdim=Math.ceil((o[0]-i[0])/e),this.ydim=Math.ceil((o[1]-i[1])/e),this.zdim=Math.ceil((o[2]-i[2])/e);var n=this.xdim*this.ydim*this.zdim;for(r=0;r<n;r++)this.boxes.push([]);for(this.find_box_id=function(t,o,r){var n=Math.floor((t-i[0])/e),s=Math.floor((o-i[1])/e),a=Math.floor((r-i[2])/e),l=(a*this.ydim+s)*this.xdim+n;return l>=0&&l<this.boxes.length?l:null},r=0;r<t.length;r++){var s=t[r].xyz,a=this.find_box_id(s[0],s[1],s[2]);if(null===a)throw Error("wrong cubicle");this.boxes[a].push(r)}}function s(t,e,i){if(t[0]<=0||t[1]<=0||t[2]<=0)throw Error("Grid dimensions are zero along at least one edge");var o=t[0]*t[1]*t[2];if(e.length!==o||i.length!==o)throw Error("isosurface: array size mismatch")}function a(t){for(var e=[],i=0;i<8;++i){var o=ot[i];e.push(o[0]+t[2]*(o[1]+t[1]*o[2]))}return e}function l(t,e,i,o,r){for(var n="snapped MC"===r,s="squarish"===r?it:et,l=new Array(12),h=a(t),c=new Float32Array(8),d=[0,0,0],u=[d,d,d,d,d,d,d,d],f=t[0],_=t[1],p=t[2],m=[],v=[],g=0,y=0;y<f-1;y++)for(var b=0;b<_-1;b++)for(var w=0;w<p-1;w++){var x,z,A=w+p*(b+_*y),M=0;for(x=0;x<8;++x)z=A+h[x],M|=e[z]<o?1<<x:0;if(0!==M&&255!==M){for(x=0;x<8;++x)z=A+h[x],c[x]=e[z],u[x]=i[z];var E=tt[M];for(x=0;x<12;++x)if(0!==(E&1<<x)){var C=rt[x],S=(o-c[C[0]])/(c[C[1]]-c[C[0]]);n===!0&&(S>.85?S=1:S<.15&&(S=0));var k=u[C[0]],O=u[C[1]];m.push(k[0]+(O[0]-k[0])*S,k[1]+(O[1]-k[1])*S,k[2]+(O[2]-k[2])*S),l[x]=g++}var L=s[M];for(x=0;x<L.length;x++)v.push(l[L[x]])}}return{vertices:m,segments:v}}function h(t,e,i,o,r){return s(t,e,i),l(t,e,i,o,r)}function c(t){this.dim=t,this.values=new Float32Array(t[0]*t[1]*t[2])}function d(t,e){var i=t%e;return i>=0?i:i+e}function u(){this.unit_cell=null,this.grid=null,this.mean=0,this.rms=1}function f(t){var e=t.toLowerCase().replace(/\s+/g,"").split(",");if(3!==e.length)throw Error("Unexpected symop: "+t);for(var i=[],o=0;o<3;o++){for(var r=e[o].split(/(?=[+-])/),n=[0,0,0,0],s=0;s<r.length;s++){var a=r[s],l="-"===a[0]?-1:1,h=r[s].match(/^[+-]?([xyz])$/);if(h){var c={x:0,y:1,z:2}[h[1]];n[c]=l}else{if(h=r[s].match(/^[+-]?(\d)\/(\d)$/),!h)throw Error("What is "+r[s]+" in "+t);n[3]=l*Number(h[1])/Number(h[2])}}i.push(n)}return i}function _(t,e,i){var o=nt.map(function(i){return{x:e.x+t*(i[0]-.5),y:e.y+t*(i[1]-.5),z:e.z+t*(i[2]-.5)}}),r=k({gl_lines:!0,color:i.color,linewidth:i.linewidth,win_size:i.win_size,segments:!0});return T(r,o)}function p(t,i){for(var o=nt.map(function(e){return{xyz:t(e)}}),r=[new e.Color(16711680),new e.Color(16755200),new e.Color(65280),new e.Color(11206400),new e.Color(255),new e.Color(43775)],n=6;n<nt.length;n++)r.push(i.color);var s=k({gl_lines:!0,linewidth:1,segments:!0});return T(s,o,r)}function m(t){var e,i=[];if(t&&t[0].xyz)for(e=0;e<t.length;e++){var o=t[e].xyz;i.push(o[0],o[1],o[2]),i.push(o[0],o[1],o[2])}else for(e=0;e<t.length;e++){var r=t[e];i.push(r.x,r.y,r.z),i.push(r.x,r.y,r.z)}return i}function v(t){for(var e=t.length,i=new Float32Array(6*e),o=0;o<e;o++){var r=t[o];i[6*o]=r.r,i[6*o+1]=r.g,i[6*o+2]=r.b,i[6*o+3]=r.r,i[6*o+4]=r.g,i[6*o+5]=r.b}return i}function g(t,i){var o,r=t.length,n=m(t),s=new Float32Array(n),a=new Float32Array(6*r);for(o=0;o<6;o++)a[o]=n[o];for(;o<6*r;o++)a[o]=n[o-6];var l=new Float32Array(6*r);for(o=0;o<6*(r-1);o++)l[o]=n[o+6];for(;o<6*r;o++)l[o]=n[o];var h=new Float32Array(2*r);for(o=0;o<r;o++)h[2*o]=1,h[2*o+1]=-1;var c=v(i),d=new e.BufferGeometry;return d.addAttribute("position",new e.BufferAttribute(s,3)),d.addAttribute("previous",new e.BufferAttribute(a,3)),d.addAttribute("next",new e.BufferAttribute(l,3)),d.addAttribute("side",new e.BufferAttribute(h,1)),d.addAttribute("color",new e.BufferAttribute(c,3)),d}function y(t,i){var o,r,n=t.length,s=m(t),a=new Float32Array(s),l=new Float32Array(6*n);for(o=0;o<6*n;o+=12){for(r=0;r<6;r++)l[o+r]=s[o+r+6];for(;r<12;r++)l[o+r]=s[o+r-6]}var h=new Float32Array(2*n);for(o=0;o<n;o++)h[2*o]=-1,h[2*o+1]=1;var c=2*n<65536?new Uint16Array(3*n):new Uint32Array(3*n),d=[0,1,2,0,2,3];for(o=0;o<n/2;o++)for(r=0;r<6;r++)c[6*o+r]=4*o+d[r];var u=new e.BufferGeometry;if(u.addAttribute("position",new e.BufferAttribute(a,3)),u.addAttribute("other",new e.BufferAttribute(l,3)),u.addAttribute("side",new e.BufferAttribute(h,1)),null!=i){var f=v(i);u.addAttribute("color",new e.BufferAttribute(f,3))}return u.setIndex(new e.BufferAttribute(c,1)),u}function b(t,i){for(var o=[],r=0;r<t.length;r++){var n=t[r].xyz;o.push(new e.Vector3(n[0],n[1],n[2]))}if(!i||i<2)return o;var s=new e.CatmullRomCurve3(o);return s.getPoints((t.length-1)*i)}function w(t,e){if(!e||e<2)return t;for(var i=[],o=0;o<t.length-1;o++)for(var r=0;r<e;r++)i.push(t[o]);return i.push(t[t.length-1]),i}function x(t,e){e=e||1;var i,o=[];for(i=0;i<t.length-1;i++)for(var r=t[i],n=t[i+1],s=0;s<e;s++){var a=s/e,l=1-a;o.push(l*r[0]+a*n[0],l*r[1]+a*n[1],l*r[2]+a*n[2])}return o.push(t[i][0],t[i][1],t[i][2]),o}function z(t){var e={fogNear:{value:null},fogFar:{value:null},fogColor:{value:null}};for(var i in t)e[i]={value:t[i]};return e}function A(t,i,o,r){var n=b(t,r),s=w(i,r),a=x(o,r),l=new e.Object3D,h=O(n,s),c=new Float32Array(a);h.addAttribute("normal",new e.BufferAttribute(c,3));for(var d=new e.ShaderMaterial({uniforms:z({shift:0}),vertexShader:ht,fragmentShader:ct,fog:!0,vertexColors:e.VertexColors}),u=-4;u<5;u++){var f=0===u?d:d.clone();f.uniforms.shift.value=.1*u,l.add(new e.Line(h,f))}return l}function M(t,i){var o=new e.BufferGeometry,r=new Float32Array(t.vertices);o.addAttribute("position",new e.BufferAttribute(r,3));var n=t.vertices.length<196608?new Uint16Array(t.segments):new Uint32Array(t.segments);o.setIndex(new e.BufferAttribute(n,1));var s=new e.LineBasicMaterial(i);return new e.LineSegments(o,s)}function E(){for(var t=50,i=[],o=-t;o<=t;o++){var r=0;o%5===0&&(r=o%2===0?2:1),i.push(-t,o,r,t,o,r),i.push(o,-t,r,o,t,r)}var n=new e.BufferGeometry;n.addAttribute("position",new e.BufferAttribute(new Float32Array(i),3));var s=new e.ShaderMaterial({uniforms:z({ucolor:new e.Color(8947848)}),vertexShader:dt,fragmentShader:ut,fog:!0});s.transparent=!0;var a=new e.LineSegments(n,s);return a.frustumCulled=!1,a.color_value=s.uniforms.ucolor.value,a}function C(t){var i={};return i.linewidth=t.linewidth,void 0===t.color?i.vertexColors=e.VertexColors:i.color=t.color,new e.LineBasicMaterial(i)}function S(t){var i=z({linewidth:t.linewidth,win_size:t.win_size});return new e.ShaderMaterial({uniforms:i,vertexShader:t.segments?at:st,fragmentShader:lt,fog:!0,vertexColors:e.VertexColors})}function k(t){return t.gl_lines?C(t):S(t)}function O(t,i){var o,r=new e.BufferGeometry,n=new Float32Array(3*t.length);if(t&&t[0].xyz)for(o=0;o<t.length;o++){var s=t[o].xyz;n[3*o]=s[0],n[3*o+1]=s[1],n[3*o+2]=s[2]}else for(o=0;o<t.length;o++){var a=t[o];n[3*o]=a.x,n[3*o+1]=a.y,n[3*o+2]=a.z}if(r.addAttribute("position",new e.BufferAttribute(n,3)),null!=i){var l=new Float32Array(3*i.length);for(o=0;o<i.length;o++){var h=i[o];l[3*o]=h.r,l[3*o+1]=h.g,l[3*o+2]=h.b}r.addAttribute("color",new e.BufferAttribute(l,3))}return r}function L(t,i,o){var r=new e.Mesh(g(i,o),t);return r.drawMode=e.TriangleStripDrawMode,r.raycast=q,r}function F(t,i,o){return t.isShaderMaterial?L(t,i,o):new e.Line(O(i,o),t)}function j(t,i,o){var r=new e.Mesh(y(i,o),t);return r.raycast=q,r}function T(t,i,o){return t.isShaderMaterial?j(t,i,o):new e.LineSegments(O(i,o),t)}function P(t,i,o){var r=O(t,i),n=new e.ShaderMaterial({uniforms:z({size:o}),vertexShader:ft,fragmentShader:_t,fog:!0,vertexColors:e.VertexColors}),s=new e.Points(r,n);return s.raycast=function(){},s}function q(t,i){var o=t.linePrecision*t.linePrecision;pt.getInverse(this.matrixWorld),mt.copy(t.ray).applyMatrix4(pt);for(var r=new e.Vector3,n=new e.Vector3,s=new e.Vector3,a=new e.Vector3,l=this.drawMode===e.TriangleStripDrawMode?1:2,h=this.geometry.attributes.position.array,c=0,d=h.length/6-1;c<d;c+=l){r.fromArray(h,6*c),n.fromArray(h,6*c+6);var u=mt.distanceSqToSegment(r,n,a,s);if(!(u>o)){a.applyMatrix4(this.matrixWorld);var f=t.ray.origin.distanceTo(a);f<t.near||f>t.far||i.push({distance:f,point:s.clone().applyMatrix4(this.matrixWorld),index:c,object:this,line_dist:Math.sqrt(u)})}}}function R(t,e){if("undefined"!=typeof document){var i=document.createElement("canvas");i.width=256,i.height=16;var o=i.getContext("2d");return o?(o.font=(e.font||"bold 14px")+" sans-serif",o.textBaseline="bottom",e.color&&(o.fillStyle=e.color),o.fillText(t,0,i.height),i):null}}function V(t,i){var o=R(t,i);if(o){var r=new e.Texture(o);r.needsUpdate=!0;var n=new e.BufferGeometry,s=i.pos,a=new Float32Array([].concat(s,s,s,s)),l=new Float32Array([0,1,1,1,0,0,1,0]),h=new Uint16Array([0,2,1,2,3,1]);n.setIndex(new e.BufferAttribute(h,1)),n.addAttribute("position",new e.BufferAttribute(a,3)),n.addAttribute("uv",new e.BufferAttribute(l,2));var c=new e.ShaderMaterial({uniforms:z({map:r,canvas_size:[o.width,o.height],win_size:i.win_size}),vertexShader:vt,fragmentShader:gt,fog:!0});c.transparent=!0;var d=new e.Mesh(n,c);return d.remake=function(t,e){r.image=R(t,e),r.needsUpdate=!0},d}}function B(t,i,o){t.push(new e.Vector3(i[0]-o,i[1],i[2])),t.push(new e.Vector3(i[0]+o,i[1],i[2])),t.push(new e.Vector3(i[0],i[1]-o,i[2])),t.push(new e.Vector3(i[0],i[1]+o,i[2])),t.push(new e.Vector3(i[0],i[1],i[2]-o)),t.push(new e.Vector3(i[0],i[1],i[2]+o))}function H(t,e){var i=0,o=t*t+e*e;if(o<1)i=Math.sqrt(1-o);else{var r=Math.sqrt(o);t/=r,e/=r}return[t,e,i]}function N(t,e){return t*e[1]/700}function U(t,i,o){var r=new e.Color(14737632);if(i<o){var n=(t-i)/(o-i),s=(240-240*n)/360;r.setHSL(s,1,.5)}return r}function K(t,e,i){var o,r,n=e[e.length-1];if("index"===t)o=function(t){return U(t.i_seq,0,n.i_seq)};else if("B-factor"===t){var s=1/0,a=-(1/0);for(r=0;r<e.length;r++){var l=e[r].b;l>a&&(a=l),l<s&&(s=l)}o=function(t){return U(t.b,s,a)}}else o="occupancy"===t?function(t){return U(t.occ,0,1)}:"chain"===t?function(t){return U(t.chain_index,0,n.chain_index)}:function(t){return i[t.element]||i.def};var h=[];for(r=0;r<e.length;r++)h.push(o(e[r]));return h}function D(t,i){this.map=t,this.name="",this.isolevel=i?3:1.5,this.visible=!0,this.types=i?["map_pos","map_neg"]:["map_den"],this.block_ctr=new e.Vector3(1/0,0,0),this.el_objects=[]}function G(t,e,i){this.model=t,this.name="",this.visible=!0,this.conf=e,this.win_size=i,this.atomic_objects=null}function Y(t){function i(e){return null===t[e]?null:document.getElementById(t[e]||e)}if(this.model_bags=[],this.map_bags=[],this.decor={cell_box:null,selection:null,zoom_grid:E()},this.labels={},this.nav=null,this.config={bond_line:4,map_line:1.25,map_radius:10,map_style:Mt[0],render_style:At[0],color_aim:zt[0],line_style:Et[0],label_font:Ct[0],colors:this.ColorSchemes[0],hydrogens:!1},this.set_colors(),this.window_size=[1,1],this.window_offset=[0,0],this.last_ctr=new e.Vector3(1/0,0,0),this.selected_atom=null,this.active_model_bag=null,this.scene=new e.Scene,this.scene.fog=new e.Fog(this.config.colors.bg,0,1),this.light=new e.AmbientLight(16777215),this.scene.add(this.light),t.share_view?(this.target=t.share_view.target,this.camera=t.share_view.camera,this.controls=t.share_view.controls,this.tied_viewer=t.share_view,this.tied_viewer.tied_viewer=this):(this.target=new e.Vector3,this.camera=new e.OrthographicCamera,this.controls=new xt(this.camera,this.target)),this.raycaster=new e.Raycaster,this.default_camera_pos=[0,0,100],this.set_common_key_bindings(),this.constructor===Y&&this.set_real_space_key_bindings(),"undefined"!=typeof document){try{this.renderer=new e.WebGLRenderer({antialias:!0})}catch(t){return this.hud("no WebGL in your browser?","ERR"),void(this.renderer=null)}if(this.container=i("viewer"),this.hud_el=i("hud"),this.help_el=i("help"),this.hud_el&&(this.initial_hud_html=this.hud_el.innerHTML,this.initial_hud_bg=this.hud_el.style["background-color"]),null!==this.container){this.renderer.setClearColor(this.config.colors.bg,1),this.renderer.setPixelRatio(window.devicePixelRatio),this.resize(),this.camera.zoom=this.camera.right/35,this.container.appendChild(this.renderer.domElement),t.focusable&&(this.renderer.domElement.tabIndex=0),this.decor.zoom_grid.visible=!1,this.scene.add(this.decor.zoom_grid),window.Stats&&(this.stats=new window.Stats,this.container.appendChild(this.stats.dom)),window.addEventListener("resize",this.resize.bind(this));var o=this.renderer.domElement,r=t.focusable?o:window;r.addEventListener("keydown",this.keydown.bind(this)),o.addEventListener("contextmenu",function(t){t.preventDefault()}),o.addEventListener("mousewheel",this.mousewheel.bind(this)),o.addEventListener("MozMousePixelScroll",this.mousewheel.bind(this)),o.addEventListener("mousedown",this.mousedown.bind(this)),o.addEventListener("touchstart",this.touchstart.bind(this)),o.addEventListener("touchmove",this.touchmove.bind(this)),o.addEventListener("touchend",this.touchend.bind(this)),o.addEventListener("touchcancel",this.touchend.bind(this)),o.addEventListener("dblclick",this.dblclick.bind(this));var n=this;this.mousemove=function(t){t.preventDefault(),n.controls.move(n.relX(t),n.relY(t))},this.mouseup=function(t){t.preventDefault(),t.stopPropagation(),document.removeEventListener("mousemove",n.mousemove),document.removeEventListener("mouseup",n.mouseup),n.decor.zoom_grid.visible=!1;var e=n.controls.stop();if(e){var i=n.pick_atom(e,n.camera);null!=i&&n.select_atom(i,{steps:60/bt})}n.redraw_maps()},this.scheduled=!1,this.request_render()}}}function I(t,e){return[t.x.toFixed(e),t.y.toFixed(e),t.z.toFixed(e)]}function X(t){var e=t.touches,i=e[0].pageX-e[1].pageX,o=e[0].pageY-e[1].pageY;return{pageX:(e[0].pageX+e[1].pageX)/2,pageY:(e[0].pageY+e[1].pageY)/2,dist:Math.sqrt(i*i+o*o)}}function W(){var t={};if("undefined"==typeof window)return t;for(var e=window.location.hash.substr(1).split("&"),i=0;i<e.length;i++){var o=e[i].split("="),r=o[1];"xyz"===o[0]||"eye"===o[0]?r=r.split(",").map(Number):"zoom"===o[0]&&(r=Number(r)),t[o[0]]=r}return t}function Z(t){Y.call(this,t),this.default_camera_pos=[100,0,0],this.axes=null,this.points=null,this.max_dist=null,this.d_min=null,this.d_max_inv=0,this.data=null,this.config.show_only=St[0],this.config.show_axes=kt[0],this.set_reciprocal_key_bindings()}t.VERSION="0.5.2";var Q=["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL","UNK"],$=["DA","DC","DG","DT","A","C","G","U","rA","rC","rG","rU","Ar","Cr","Gr","Ur"],J=["HOH"].concat(Q,$);o.prototype.from_pdb=function(t){for(var e=t.split("\n"),o=0,n=null,s=0,a=0;a<e.length;a++){var l=e[a],h=l.substring(0,6);if("ATOM  "===h||"HETATM"===h){var c=new r;c.from_pdb_line(l),c.i_seq=s++,this.has_hydrogens||"H"!==c.element||(this.has_hydrogens=!0),c.chain!==n&&o++,c.chain_index=o,n=c.chain,this.atoms.push(c)}else if("ANISOU"===h);else if("CRYST1"===h){var d=parseFloat(l.substring(6,15)),u=parseFloat(l.substring(15,24)),f=parseFloat(l.substring(24,33)),_=parseFloat(l.substring(33,40)),p=parseFloat(l.substring(40,47)),m=parseFloat(l.substring(47,54));this.unit_cell=new i(d,u,f,_,p,m)}else"TER"===h.substring(0,3)&&(n=null)}if(0===this.atoms.length)throw Error("No atom records found.");this.calculate_bounds(),this.calculate_connectivity()},o.prototype.calculate_bounds=function(){for(var t=this.lower_bound=[1/0,1/0,1/0],e=this.upper_bound=[-(1/0),-(1/0),-(1/0)],i=0;i<this.atoms.length;i++)for(var o=this.atoms[i],r=0;r<3;r++){var n=o.xyz[r];n<t[r]&&(t[r]=n),n>e[r]&&(e[r]=n)}for(var s=0;s<3;++s)t[s]-=.001,e[s]+=.001},o.prototype.next_residue=function(t,e){for(var i=this.atoms.length,o=(t?t.i_seq:0)+i,r=t?1:0;r<i;r++){var n=(o+(e?-r:r))%i,s=this.atoms[n];if(s.is_main_conformer()&&("CA"===s.name&&"C"===s.element||"P"===s.name))return s}},o.prototype.extract_trace=function(){for(var t=[],e=[],i=null,o=0;o<this.atoms.length;o++){var r=this.atoms[o];if((""===r.altloc||"A"===r.altloc)&&("CA"===r.name&&"C"===r.element||"P"===r.name)){var n=!0;if(null!==i&&i.chain_index===r.chain_index){var s=r.distance_sq(i);("CA"===r.name&&s<=30.25||"P"===r.name&&s<56.25)&&(e.push(r),n=!1)}n&&(e.length>2&&t.push(e),e=[r]),i=r}}return e.length>2&&t.push(e),t},o.prototype.get_residues=function(){if(null!=this.residue_map)return this.residue_map;for(var t={},e=0;e<this.atoms.length;e++){var i=this.atoms[e],o=i.resid(),r=t[o];void 0===r?t[o]=[i]:r.push(i)}return this.residue_map=t,t},o.prototype.calculate_tangent_vector=function(t){for(var e=null,i=null,o=3===t[0].resname.length,r=o?"C":"C2'",n=o?"O":"O4'",s=0;s<t.length;s++){var a=t[s];a.is_main_conformer()&&(a.name===r?e=a.xyz:a.name===n&&(i=a.xyz))}if(null===e||null===i)return[0,0,1];var l=[e[0]-i[0],e[1]-i[1],e[2]-i[2]],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);return[l[0]/h,l[1]/h,l[2]/h]},o.prototype.get_center=function(){for(var t=0,e=0,i=0,o=this.atoms.length,r=0;r<o;r++){var n=this.atoms[r].xyz;t+=n[0],e+=n[1],i+=n[2]}return[t/o,e/o,i/o]},r.prototype.from_pdb_line=function(t){if(t.length<66)throw Error("ATOM or HETATM record is too short: "+t);var e=t.substring(0,6);if("HETATM"===e)this.hetero=!0;else if("ATOM  "!==e)throw Error("Wrong record type: "+e);this.name=t.substring(12,16).trim(),this.altloc=t.substring(16,17).trim(),this.resname=t.substring(17,20).trim(),this.chain=t.substring(20,22).trim(),this.resseq=parseInt(t.substring(22,26),10),this.icode=t.substring(26,27).trim();var i=parseFloat(t.substring(30,38)),o=parseFloat(t.substring(38,46)),r=parseFloat(t.substring(46,54));this.xyz=[i,o,r],this.occ=parseFloat(t.substring(54,60)),this.b=parseFloat(t.substring(60,66)),t.length>=78&&(this.element=t.substring(76,78).trim().toUpperCase()),t.length>=80&&(this.charge=t.substring(78,80).trim()),this.is_ligand=J.indexOf(this.resname)===-1},r.prototype.b_as_u=function(){return Math.sqrt(this.b/(25.13272*3.14159))},r.prototype.distance_sq=function(t){var e=this.xyz[0]-t.xyz[0],i=this.xyz[1]-t.xyz[1],o=this.xyz[2]-t.xyz[2];return e*e+i*i+o*o},r.prototype.distance=function(t){return Math.sqrt(this.distance_sq(t))},r.prototype.midpoint=function(t){return[(this.xyz[0]+t.xyz[0])/2,(this.xyz[1]+t.xyz[1])/2,(this.xyz[2]+t.xyz[2])/2]},r.prototype.is_hydrogen=function(){return"H"===this.element||"D"===this.element},r.prototype.is_s_or_p=function(){return"S"===this.element||"P"===this.element},r.prototype.is_ion=function(){return this.element===this.resname},r.prototype.is_water=function(){return"HOH"===this.resname},r.prototype.is_same_residue=function(t,e){return t.resseq===this.resseq&&t.icode===this.icode&&t.chain===this.chain&&t.resname===this.resname&&(e||t.altloc===this.altloc)},r.prototype.is_same_conformer=function(t){return""===this.altloc||""===t.altloc||this.altloc===t.altloc},r.prototype.is_main_conformer=function(){return""===this.altloc||"A"===this.altloc},r.prototype.is_bonded_to=function(t){var e=3.9601,i=1.3*1.3,o=2.2*2.2;if(!this.is_same_conformer(t))return!1;if("H"===this.element&&"H"===t.element)return!1;var r=this.distance_sq(t);return!(r>o)&&("H"===this.element||"H"===t.element?r<=i:r<=e||this.is_s_or_p()||t.is_s_or_p())},r.prototype.resid=function(){return this.resseq+"/"+this.chain},r.prototype.long_label=function(){var t=this;return t.name+" /"+t.resseq+" "+t.resname+"/"+t.chain+" - occ: "+t.occ.toFixed(2)+" bf: "+t.b.toFixed(2)+" ele: "+t.element+" pos: ("+t.xyz[0].toFixed(2)+","+t.xyz[1].toFixed(2)+","+t.xyz[2].toFixed(2)+")"},r.prototype.short_label=function(){var t=this;return t.name+" /"+t.resseq+" "+t.resname+"/"+t.chain},n.prototype.get_nearby_atoms=function(t){var e=[],i=this.xdim*this.ydim,o=Math.max(t%i,0),r=Math.max(o%this.xdim,0),n=Math.floor(o/this.xdim),s=Math.floor(t/i);console.assert(s*i+n*this.xdim+r===t);for(var a=r-1;a<=r+1;a++)if(!(a<0||a>=this.xdim))for(var l=n-1;l<=n+1;l++)if(!(l<0||l>=this.ydim))for(var h=s-1;h<=s+1;h++)if(!(h<0||h>=this.zdim)){var c=h*i+l*this.xdim+a;if(c>=this.boxes.length||c<0)throw Error("Box out of bounds: ID "+c);for(var d=this.boxes[c],u=0;u<d.length;u++)e.push(d[u])}return e},o.prototype.calculate_connectivity=function(){for(var t=this.atoms,e=new n(t,3,this.lower_bound,this.upper_bound),i=0;i<e.boxes.length;i++){var o=e.boxes[i];if(0!==o.length)for(var r=e.get_nearby_atoms(i),s=0;s<o.length;s++)for(var a=o[s],l=0;l<r.length;l++){var h=r[l];h>a&&t[a].is_bonded_to(t[h])&&(t[a].bonds.push(h),t[h].bonds.push(a))}}this.cubes=e},o.prototype.get_nearest_atom=function(t,e,i,o){for(var r=this.cubes.find_box_id(t,e,i),n=this.cubes.get_nearby_atoms(r),s=null,a=1/0,l=0;l<n.length;l++){var h=this.atoms[n[l]];if(void 0===o||null===o||o===h.name){var c=h.xyz[0]-t,d=h.xyz[1]-e,u=h.xyz[2]-i,f=c*c+d*d+u*u;f<a&&(s=h,a=f)}}return s};var tt=new Int32Array([0,0,514,770,1030,1030,1540,1796,2052,2053,2566,2566,3082,3331,3592,3840,144,152,658,658,1174,1182,1684,1684,2196,2196,2710,2710,3226,3218,3729,3728,560,560,51,314,1590,1590,1076,1084,2612,2613,2103,2358,3642,3890,3121,3376,672,680,163,170,1702,1711,1444,1196,2724,2724,2470,2214,4010,3747,3233,3232,1120,1120,1634,1890,102,102,613,868,3172,3173,3686,3686,2154,2147,2665,2656,1264,1272,1778,1778,246,254,757,764,3316,3316,3830,3830,2298,2291,2809,2800,1616,1616,1107,1362,598,598,84,340,3668,3924,3159,3414,2650,2898,2137,2384,1984,1729,1474,1218,966,718,197,196,4036,3781,3526,3270,3018,2754,2241,2240,2240,2240,2754,3010,3270,3270,3780,4044,196,197,710,966,1218,1474,1729,1984,2384,2137,2898,2650,3414,3159,3668,3676,340,84,606,598,1362,1107,1624,1616,2800,2800,2291,2298,3830,3830,3316,3324,756,1013,255,502,1778,1779,1273,1520,2656,2665,2147,2154,3686,3687,3429,3180,868,613,358,102,1898,1635,1120,1120,3232,3232,3746,4002,2214,2214,2724,2980,1196,1444,1710,1958,170,163,680,672,3376,3121,3890,3642,2358,2103,2869,2612,1084,1076,1854,1590,314,51,825,560,3728,3728,3218,3226,2710,2710,2196,2204,1684,1685,1183,1174,658,914,152,144,3840,3592,3331,3082,2566,2574,2053,2052,1796,1540,1286,1030,770,514,0,0]),et=[[],[],[1,9],[1,8,1,9],[2,10,10,1],[2,10,10,1],[9,2,2,10,10,9],[2,8,2,10,10,8,10,9],[11,2],[0,11,11,2],[1,9,11,2],[1,11,11,2,1,9,9,11],[3,10,10,1,11,10],[0,10,10,1,8,10,11,10],[3,9,11,9,11,10,10,9],[8,10,10,9,11,10],[4,7],[4,3,4,7],[1,9,4,7],[4,1,1,9,4,7,7,1],[2,10,10,1,4,7],[3,4,4,7,2,10,10,1],[9,2,2,10,10,9,4,7],[2,10,10,9,9,2,9,7,7,2,4,7],[4,7,11,2],[11,4,4,7,11,2,2,4],[1,9,4,7,11,2],[4,7,11,4,11,9,11,2,2,9,1,9],[3,10,10,1,11,10,4,7],[1,11,11,10,10,1,1,4,4,11,4,7],[4,7,0,11,11,9,11,10,10,9],[4,7,11,4,11,9,11,10,10,9],[9,5,5,4],[9,5,5,4],[0,5,5,4,1,5],[8,5,5,4,3,5,1,5],[2,10,10,1,9,5,5,4],[2,10,10,1,9,5,5,4],[5,2,2,10,10,5,5,4,4,2],[2,10,10,5,5,2,5,3,5,4,4,3],[9,5,5,4,11,2],[0,11,11,2,9,5,5,4],[0,5,5,4,1,5,11,2],[1,5,5,2,5,8,8,2,11,2,5,4],[10,3,11,10,10,1,9,5,5,4],[9,5,5,4,8,1,8,10,10,1,11,10],[5,4,0,5,0,11,11,5,11,10,10,5],[5,4,8,5,8,10,10,5,11,10],[9,7,5,7,9,5],[9,3,9,5,5,3,5,7],[0,7,1,7,1,5,5,7],[1,5,5,3,5,7],[9,7,9,5,5,7,10,1,2,10],[10,1,2,10,9,5,5,0,5,3,5,7],[2,8,2,5,5,8,5,7,10,5,2,10],[2,10,10,5,5,2,5,3,5,7],[7,9,9,5,5,7,11,2],[9,5,5,7,7,9,7,2,2,9,11,2],[11,2,1,8,1,7,1,5,5,7],[11,2,1,11,1,7,1,5,5,7],[9,5,5,8,5,7,10,1,3,10,11,10],[5,7,7,0,0,5,9,5,11,0,0,10,10,1,11,10],[11,10,10,0,0,11,10,5,5,0,0,7,5,7],[11,10,10,5,5,11,5,7],[10,6,6,5,5,10],[5,10,10,6,6,5],[1,9,5,10,10,6,6,5],[1,8,1,9,5,10,10,6,6,5],[1,6,6,5,5,1,2,6],[1,6,6,5,5,1,2,6],[9,6,6,5,5,9,0,6,2,6],[5,9,8,5,8,2,2,5,2,6,6,5],[11,2,10,6,6,5,5,10],[11,0,11,2,10,6,6,5,5,10],[1,9,11,2,5,10,10,6,6,5],[5,10,10,6,6,5,1,9,9,2,9,11,11,2],[6,3,11,6,6,5,5,3,5,1],[11,0,11,5,5,0,5,1,11,6,6,5],[11,6,6,3,6,0,6,5,5,0,5,9],[6,5,5,9,9,6,9,11,11,6],[5,10,10,6,6,5,4,7],[4,3,4,7,6,5,5,10,10,6],[1,9,5,10,10,6,6,5,4,7],[10,6,6,5,5,10,1,9,9,7,7,1,4,7],[6,1,2,6,6,5,5,1,4,7],[2,5,5,1,2,6,6,5,4,3,4,7],[4,7,0,5,5,9,0,6,6,5,2,6],[3,9,9,7,4,7,2,9,5,9,9,6,6,5,2,6],[11,2,4,7,10,6,6,5,5,10],[5,10,10,6,6,5,4,7,7,2,2,4,11,2],[1,9,4,7,11,2,5,10,10,6,6,5],[9,2,1,9,9,11,11,2,4,11,4,7,5,10,10,6,6,5],[4,7,11,5,5,3,5,1,11,6,6,5],[5,1,1,11,11,5,11,6,6,5,0,11,11,4,4,7],[0,5,5,9,0,6,6,5,3,6,11,6,4,7],[6,5,5,9,9,6,9,11,11,6,4,7,7,9],[10,4,9,10,6,4,10,6],[4,10,10,6,6,4,9,10],[10,0,1,10,10,6,6,0,6,4],[1,8,1,6,6,8,6,4,1,10,10,6],[1,4,9,1,2,4,2,6,6,4],[2,9,9,1,2,4,2,6,6,4],[2,4,2,6,6,4],[2,8,2,4,2,6,6,4],[10,4,9,10,10,6,6,4,11,2],[8,2,11,2,9,10,10,4,10,6,6,4],[11,2,1,6,6,0,6,4,1,10,10,6],[6,4,4,1,1,6,1,10,10,6,8,1,1,11,11,2],[9,6,6,4,9,3,3,6,9,1,11,6],[11,1,1,8,11,6,6,1,9,1,1,4,6,4],[11,6,6,3,6,0,6,4],[6,4,8,6,11,6],[7,10,10,6,6,7,8,10,9,10],[0,7,0,10,10,7,9,10,6,7,10,6],[10,6,6,7,7,10,1,10,7,1,8,1],[10,6,6,7,7,10,7,1,1,10],[2,6,6,1,6,8,8,1,9,1,6,7],[2,6,6,9,9,2,9,1,6,7,7,9,9,3],[0,7,0,6,6,7,2,6],[2,7,6,7,2,6],[11,2,10,6,6,8,8,10,9,10,6,7],[0,7,7,2,11,2,9,7,6,7,7,10,10,6,9,10],[1,8,1,7,1,10,10,7,6,7,10,6,11,2],[11,2,1,11,1,7,10,6,6,1,1,10,6,7],[9,6,6,8,6,7,9,1,1,6,11,6,6,3],[9,1,11,6,6,7],[0,7,0,6,6,7,11,0,11,6],[11,6,6,7],[7,6,6,11],[7,6,6,11],[1,9,7,6,6,11],[8,1,1,9,7,6,6,11],[10,1,2,10,6,11,7,6],[2,10,10,1,6,11,7,6],[2,9,2,10,10,9,6,11,7,6],[6,11,7,6,2,10,10,3,10,8,10,9],[7,2,6,2,7,6],[7,0,7,6,6,0,6,2],[2,7,7,6,6,2,1,9],[1,6,6,2,1,8,8,6,1,9,7,6],[10,7,7,6,6,10,10,1,1,7],[10,7,7,6,6,10,1,7,10,1,1,8],[7,0,7,10,10,0,10,9,6,10,7,6],[7,6,6,10,10,7,10,8,10,9],[6,8,4,6,6,11],[3,6,6,11,0,6,4,6],[8,6,6,11,4,6,1,9],[4,6,6,9,6,3,3,9,1,9,6,11],[6,8,4,6,6,11,2,10,10,1],[2,10,10,1,0,11,0,6,6,11,4,6],[4,11,4,6,6,11,2,9,2,10,10,9],[10,9,9,3,3,10,2,10,4,3,3,6,6,11,4,6],[8,2,4,2,4,6,6,2],[4,2,4,6,6,2],[1,9,3,4,4,2,4,6,6,2],[1,9,4,1,4,2,4,6,6,2],[8,1,8,6,6,1,4,6,6,10,10,1],[10,1,0,10,0,6,6,10,4,6],[4,6,6,3,3,4,6,10,10,3,3,9,10,9],[10,9,4,10,6,10,4,6],[9,5,5,4,7,6,6,11],[9,5,5,4,7,6,6,11],[5,0,1,5,5,4,7,6,6,11],[7,6,6,11,3,4,3,5,5,4,1,5],[9,5,5,4,10,1,2,10,7,6,6,11],[6,11,7,6,2,10,10,1,9,5,5,4],[7,6,6,11,5,4,4,10,10,5,4,2,2,10],[3,4,3,5,5,4,2,5,10,5,2,10,7,6,6,11],[7,2,7,6,6,2,5,4,9,5],[9,5,5,4,8,6,6,0,6,2,7,6],[3,6,6,2,7,6,1,5,5,0,5,4],[6,2,2,8,8,6,7,6,1,8,8,5,5,4,1,5],[9,5,5,4,10,1,1,6,6,10,1,7,7,6],[1,6,6,10,10,1,1,7,7,6,0,7,9,5,5,4],[0,10,10,4,10,5,5,4,3,10,6,10,10,7,7,6],[7,6,6,10,10,7,10,8,5,4,4,10,10,5],[6,9,9,5,5,6,6,11,11,9],[3,6,6,11,0,6,0,5,5,6,9,5],[0,11,0,5,5,11,1,5,5,6,6,11],[6,11,3,6,3,5,5,6,1,5],[2,10,10,1,9,5,5,11,11,9,5,6,6,11],[0,11,0,6,6,11,9,6,5,6,9,5,2,10,10,1],[8,5,5,11,5,6,6,11,0,5,10,5,5,2,2,10],[6,11,3,6,3,5,5,6,2,10,10,3,10,5],[5,8,9,5,5,2,2,8,5,6,6,2],[9,5,5,6,6,9,6,0,6,2],[1,5,5,8,8,1,5,6,6,8,8,2,6,2],[1,5,5,6,6,1,6,2],[3,6,6,1,6,10,10,1,8,6,5,6,6,9,9,5],[10,1,0,10,0,6,6,10,9,5,5,0,5,6],[5,6,6,10,10,5],[10,5,5,6,6,10],[11,5,5,10,10,11,7,5],[11,5,5,10,10,11,7,5],[5,11,7,5,5,10,10,11,1,9],[10,7,7,5,5,10,10,11,8,1,1,9],[11,1,2,11,7,1,7,5,5,1],[2,7,7,1,7,5,5,1,2,11],[9,7,7,5,5,9,9,2,2,7,2,11],[7,5,5,2,2,7,2,11,5,9,9,2,2,8],[2,5,5,10,10,2,3,5,7,5],[8,2,8,5,5,2,7,5,10,2,5,10],[1,9,5,10,10,3,3,5,7,5,10,2],[8,2,2,9,1,9,7,2,10,2,2,5,5,10,7,5],[3,5,5,1,7,5],[7,0,7,1,7,5,5,1],[3,9,3,5,5,9,7,5],[7,9,5,9,7,5],[5,8,4,5,5,10,10,8,10,11],[5,0,4,5,5,11,11,0,5,10,10,11],[1,9,4,10,10,8,10,11,4,5,5,10],[10,11,11,4,4,10,4,5,5,10,3,4,4,1,1,9],[2,5,5,1,2,8,8,5,2,11,4,5],[4,11,11,0,4,5,5,11,2,11,11,1,5,1],[2,5,5,0,5,9,2,11,11,5,4,5,5,8],[4,5,5,9,2,11],[2,5,5,10,10,2,3,5,3,4,4,5],[5,10,10,2,2,5,2,4,4,5],[3,10,10,2,3,5,5,10,8,5,4,5,1,9],[5,10,10,2,2,5,2,4,4,5,1,9,9,2],[4,5,5,8,5,3,5,1],[4,5,5,0,5,1],[4,5,5,8,5,3,0,5,5,9],[4,5,5,9],[4,11,7,4,9,11,9,10,10,11],[9,7,7,4,9,11,9,10,10,11],[1,10,10,11,11,1,11,4,4,1,7,4],[1,4,4,3,1,10,10,4,7,4,4,11,10,11],[4,11,7,4,9,11,9,2,2,11,9,1],[9,7,7,4,9,11,9,1,1,11,2,11],[7,4,4,11,4,2,2,11],[7,4,4,11,4,2,2,11,3,4],[2,9,9,10,10,2,2,7,7,9,7,4],[9,10,10,7,7,9,7,4,10,2,2,7,7,0],[7,10,10,3,10,2,7,4,4,10,1,10,10,0],[1,10,10,2,7,4],[9,1,1,4,1,7,7,4],[9,1,1,4,1,7,7,4,8,1],[3,4,7,4],[7,4],[9,10,10,8,10,11],[9,3,9,11,9,10,10,11],[1,10,10,0,10,8,10,11],[1,10,10,3,10,11],[2,11,11,1,11,9,9,1],[9,3,9,11,2,9,9,1,2,11],[2,11,11,0],[2,11],[8,2,8,10,10,2,9,10],[9,10,10,2,2,9],[8,2,8,10,10,2,1,8,1,10],[1,10,10,2],[8,1,9,1],[9,1],[],[]],it=[[],[],[1,9],[1,9],[2,10,10,1],[2,10,10,1],[2,10,10,9],[2,10,10,9],[11,2],[11,2],[1,9,11,2],[11,2,1,9],[10,1,11,10],[10,1,11,10],[11,10,10,9],[10,9,11,10],[4,7],[4,7],[1,9,4,7],[1,9,4,7],[2,10,10,1,4,7],[4,7,2,10,10,1],[2,10,10,9,4,7],[2,10,10,9,4,7],[4,7,11,2],[4,7,11,2],[1,9,4,7,11,2],[4,7,11,2,1,9],[10,1,11,10,4,7],[11,10,10,1,4,7],[4,7,11,10,10,9],[4,7,11,10,10,9],[9,5,5,4],[9,5,5,4],[5,4,1,5],[5,4,1,5],[2,10,10,1,9,5,5,4],[2,10,10,1,9,5,5,4],[2,10,10,5,5,4],[2,10,10,5,5,4],[9,5,5,4,11,2],[11,2,9,5,5,4],[5,4,1,5,11,2],[1,5,11,2,5,4],[11,10,10,1,9,5,5,4],[9,5,5,4,10,1,11,10],[5,4,11,10,10,5],[5,4,10,5,11,10],[5,7,9,5],[9,5,5,7],[1,5,5,7],[1,5,5,7],[9,5,5,7,10,1,2,10],[10,1,2,10,9,5,5,7],[5,7,10,5,2,10],[2,10,10,5,5,7],[9,5,5,7,11,2],[9,5,5,7,11,2],[11,2,1,5,5,7],[11,2,1,5,5,7],[9,5,5,7,10,1,11,10],[5,7,9,5,10,1,11,10],[11,10,10,5,5,7],[11,10,10,5,5,7],[10,6,6,5,5,10],[5,10,10,6,6,5],[1,9,5,10,10,6,6,5],[1,9,5,10,10,6,6,5],[6,5,5,1,2,6],[6,5,5,1,2,6],[6,5,5,9,2,6],[5,9,2,6,6,5],[11,2,10,6,6,5,5,10],[11,2,10,6,6,5,5,10],[1,9,11,2,5,10,10,6,6,5],[5,10,10,6,6,5,1,9,11,2],[11,6,6,5,5,1],[5,1,11,6,6,5],[11,6,6,5,5,9],[6,5,5,9,11,6],[5,10,10,6,6,5,4,7],[4,7,6,5,5,10,10,6],[1,9,5,10,10,6,6,5,4,7],[10,6,6,5,5,10,1,9,4,7],[2,6,6,5,5,1,4,7],[5,1,2,6,6,5,4,7],[4,7,5,9,6,5,2,6],[4,7,5,9,6,5,2,6],[11,2,4,7,10,6,6,5,5,10],[5,10,10,6,6,5,4,7,11,2],[1,9,4,7,11,2,5,10,10,6,6,5],[1,9,11,2,4,7,5,10,10,6,6,5],[4,7,5,1,11,6,6,5],[5,1,11,6,6,5,4,7],[5,9,6,5,11,6,4,7],[6,5,5,9,11,6,4,7],[9,10,6,4,10,6],[10,6,6,4,9,10],[1,10,10,6,6,4],[6,4,1,10,10,6],[9,1,2,6,6,4],[9,1,2,6,6,4],[2,6,6,4],[2,6,6,4],[9,10,10,6,6,4,11,2],[11,2,9,10,10,6,6,4],[11,2,6,4,1,10,10,6],[6,4,1,10,10,6,11,2],[6,4,9,1,11,6],[11,6,9,1,6,4],[11,6,6,4],[6,4,11,6],[10,6,6,7,9,10],[9,10,6,7,10,6],[10,6,6,7,1,10],[10,6,6,7,1,10],[2,6,9,1,6,7],[2,6,9,1,6,7],[6,7,2,6],[6,7,2,6],[11,2,10,6,9,10,6,7],[11,2,6,7,10,6,9,10],[1,10,6,7,10,6,11,2],[11,2,10,6,1,10,6,7],[6,7,9,1,11,6],[9,1,11,6,6,7],[6,7,11,6],[11,6,6,7],[7,6,6,11],[7,6,6,11],[1,9,7,6,6,11],[1,9,7,6,6,11],[10,1,2,10,6,11,7,6],[2,10,10,1,6,11,7,6],[2,10,10,9,6,11,7,6],[6,11,7,6,2,10,10,9],[6,2,7,6],[7,6,6,2],[7,6,6,2,1,9],[6,2,1,9,7,6],[7,6,6,10,10,1],[7,6,6,10,10,1],[10,9,6,10,7,6],[7,6,6,10,10,9],[4,6,6,11],[6,11,4,6],[6,11,4,6,1,9],[4,6,1,9,6,11],[4,6,6,11,2,10,10,1],[2,10,10,1,6,11,4,6],[4,6,6,11,2,10,10,9],[10,9,2,10,6,11,4,6],[4,6,6,2],[4,6,6,2],[1,9,4,6,6,2],[1,9,4,6,6,2],[4,6,6,10,10,1],[10,1,6,10,4,6],[4,6,6,10,10,9],[10,9,6,10,4,6],[9,5,5,4,7,6,6,11],[9,5,5,4,7,6,6,11],[1,5,5,4,7,6,6,11],[7,6,6,11,5,4,1,5],[9,5,5,4,10,1,2,10,7,6,6,11],[6,11,7,6,2,10,10,1,9,5,5,4],[7,6,6,11,5,4,10,5,2,10],[5,4,10,5,2,10,7,6,6,11],[7,6,6,2,5,4,9,5],[9,5,5,4,6,2,7,6],[6,2,7,6,1,5,5,4],[6,2,7,6,5,4,1,5],[9,5,5,4,10,1,6,10,7,6],[6,10,10,1,7,6,9,5,5,4],[10,5,5,4,6,10,7,6],[7,6,6,10,5,4,10,5],[9,5,5,6,6,11],[6,11,5,6,9,5],[1,5,5,6,6,11],[6,11,5,6,1,5],[2,10,10,1,9,5,5,6,6,11],[6,11,5,6,9,5,2,10,10,1],[5,6,6,11,10,5,2,10],[6,11,5,6,2,10,10,5],[9,5,5,6,6,2],[9,5,5,6,6,2],[1,5,5,6,6,2],[1,5,5,6,6,2],[6,10,10,1,5,6,9,5],[10,1,6,10,9,5,5,6],[5,6,6,10,10,5],[10,5,5,6,6,10],[5,10,10,11,7,5],[5,10,10,11,7,5],[7,5,5,10,10,11,1,9],[7,5,5,10,10,11,1,9],[2,11,7,5,5,1],[7,5,5,1,2,11],[7,5,5,9,2,11],[7,5,2,11,5,9],[5,10,10,2,7,5],[7,5,10,2,5,10],[1,9,5,10,7,5,10,2],[1,9,10,2,5,10,7,5],[5,1,7,5],[7,5,5,1],[5,9,7,5],[5,9,7,5],[4,5,5,10,10,11],[4,5,5,10,10,11],[1,9,10,11,4,5,5,10],[10,11,4,5,5,10,1,9],[5,1,2,11,4,5],[4,5,2,11,5,1],[5,9,2,11,4,5],[4,5,5,9,2,11],[5,10,10,2,4,5],[5,10,10,2,4,5],[10,2,5,10,4,5,1,9],[5,10,10,2,4,5,1,9],[4,5,5,1],[4,5,5,1],[4,5,5,9],[4,5,5,9],[7,4,9,10,10,11],[7,4,9,10,10,11],[1,10,10,11,7,4],[1,10,7,4,10,11],[7,4,2,11,9,1],[7,4,9,1,2,11],[7,4,2,11],[7,4,2,11],[9,10,10,2,7,4],[9,10,7,4,10,2],[10,2,7,4,1,10],[1,10,10,2,7,4],[9,1,7,4],[9,1,7,4],[7,4],[7,4],[9,10,10,11],[9,10,10,11],[1,10,10,11],[1,10,10,11],[2,11,9,1],[9,1,2,11],[2,11],[2,11],[10,2,9,10],[9,10,10,2],[10,2,1,10],[1,10,10,2],[9,1],[9,1],[],[]],ot=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],rt=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];
c.prototype.grid2index=function(t,e,i){return t=d(t,this.dim[0]),e=d(e,this.dim[1]),i=d(i,this.dim[2]),this.dim[2]*(this.dim[1]*t+e)+i},c.prototype.grid2frac=function(t,e,i){return[t/this.dim[0],e/this.dim[1],i/this.dim[2]]},c.prototype.frac2grid=function(t){return[0|Math.floor(t[0]*this.dim[0]),0|Math.floor(t[1]*this.dim[1]),0|Math.floor(t[2]*this.dim[2])]},c.prototype.set_grid_value=function(t,e,i,o){var r=this.grid2index(t,e,i);this.values[r]=o},c.prototype.get_grid_value=function(t,e,i){var o=this.grid2index(t,e,i);return this.values[o]},u.prototype.calculate_stddev=function(t,e){for(var i=0,o=0,r=t.length,n=e;n<r;n++)i+=t[n],o+=t[n]*t[n];var s=i/(r-e),a=o/(r-e)-s*s;this.mean=s,this.rms=Math.sqrt(a)},u.prototype.abs_level=function(t){return t*this.rms+this.mean},u.prototype.from_ccp4=function(t,e){if(void 0===e&&(e=!0),t.byteLength<1024)throw Error("File shorter than 1024 bytes.");var o=new Int32Array(t,0,256);if(542130509!==o[52])throw Error("not a CCP4 map");var r=[o[0],o[1],o[2]];this.mode=o[3];var n;if(2===this.mode)n=4;else{if(0!==this.mode)throw Error("Only Mode 2 and Mode 0 of CCP4 map is supported.");n=1}var s=[o[4],o[5],o[6]],a=[o[7],o[8],o[9]],l=o[23];if(1024+l+n*r[0]*r[1]*r[2]!==t.byteLength)throw Error("ccp4 file too short or too long");var h=new Float32Array(t,0,t.byteLength>>2);this.unit_cell=new i(h[10],h[11],h[12],h[13],h[14],h[15]);var d=[o[16],o[17],o[18]],u=d.indexOf(1),_=d.indexOf(2),p=d.indexOf(3);if(this.min=h[19],this.max=h[20],this.sg_number=o[22],this.lskflg=o[24],this.grid=new c(a),l%4!==0)throw Error("CCP4 map with NSYMBT not divisible by 4 is not supported.");var m;m=2===this.mode?h:new Int8Array(t);var v=(1024+l)/n|0;this.mean=h[21],this.rms=h[54],(this.mean<this.min||this.mean>this.max||this.rms<=0)&&this.calculate_stddev(m,v);var g=1,y=0;0===this.mode&&o[39]===-128&&127===o[40]&&(g=(this.max-this.min)/255,y=.5*(this.min+this.max+g));var b=[s[0]+r[0],s[1]+r[1],s[2]+r[2]],w=[0,0,0];for(w[2]=s[2];w[2]<b[2];w[2]++)for(w[1]=s[1];w[1]<b[1];w[1]++)for(w[0]=s[0];w[0]<b[0];w[0]++)this.grid.set_grid_value(w[u],w[_],w[p],g*m[v]+y),v++;if(e&&l>0)for(var x=new Uint8Array(t),z=0;z+80<=l;z+=80){var A,M="";for(A=0;A<80;++A)M+=String.fromCharCode(x[1024+z+A]);if(!/^\s*x\s*,\s*y\s*,\s*z\s*$/i.test(M)){var E=f(M);for(A=0;A<3;++A)E[A][3]=0|Math.round(E[A][3]*a[A]);v=(1024+l)/n|0;var C=[0,0,0];for(w[2]=s[2];w[2]<b[2];w[2]++)for(w[1]=s[1];w[1]<b[1];w[1]++)for(w[0]=s[0];w[0]<b[0];w[0]++){for(A=0;A<3;++A)C[A]=w[u]*E[A][0]+w[_]*E[A][1]+w[p]*E[A][2]+E[A][3];this.grid.set_grid_value(C[0],C[1],C[2],g*m[v]+y),v++}}}},u.prototype.from_dsn6=function(t){var e=new Uint8Array(t),o=new Int16Array(e.buffer);if(100!==o[18])for(var r=o.length,n=0;n<r;n++){var s=o[n];o[n]=(255&s)<<8|s>>8&255}if(100!==o[18])throw Error("Endian swap failed");var a=[o[0],o[1],o[2]],l=[o[3],o[4],o[5]],h=[o[6],o[7],o[8]],d=1/o[17];this.unit_cell=new i(d*o[9],d*o[10],d*o[11],d*o[12],d*o[13],d*o[14]),this.grid=new c(h);for(var u=o[15]/100,f=o[16],_=512,p=[Math.ceil(l[0]/8),Math.ceil(l[1]/8),Math.ceil(l[2]/8)],m=0;m<p[2];m++)for(var v=0;v<p[1];v++)for(var g=0;g<p[0];g++)for(var y=0;y<8;y++)for(var b=8*m+y,w=0;w<8;w++)for(var x=8*v+w,z=0;z<8;z++){var A=8*g+z;if(!(A<l[0]&&x<l[1]&&b<l[2])){_+=8-z;break}var M=(e[_]-f)/u;_++,this.grid.set_grid_value(a[0]+A,a[1]+x,a[2]+b,M)}this.calculate_stddev(this.grid.values,0)},u.prototype.show_debug_info=function(){console.log("unit cell: "+this.unit_cell.parameters.join(", ")),console.log("grid: "+this.grid.dim)},u.prototype.extract_block=function(t,e){var i=this.grid,o=this.unit_cell,r=[0,0,0],n=i.dim;if(e){var s=[e[0]-t,e[1]-t,e[2]-t],a=[e[0]+t,e[1]+t,e[2]+t],l=o.fractionalize(s),h=o.fractionalize(a);r=i.frac2grid(l),n=i.frac2grid(h)}for(var c=n[0]-r[0]+1,d=n[1]-r[1]+1,u=n[2]-r[2]+1,f=[],_=[],p=r[0];p<=n[0];p++)for(var m=r[1];m<=n[1];m++)for(var v=r[2];v<=n[2];v++){var g=i.grid2frac(p,m,v),y=o.orthogonalize(g);f.push(y);var b=i.get_grid_value(p,m,v);_.push(b)}this.block={points:f,values:_,size:[c,d,u]}},u.prototype.isomesh_in_block=function(t,e){var i=this.abs_level(t),o=this.block;return h(o.size,o.values,o.points,i,e)};var nt=[[0,0,0],[1,0,0],[0,0,0],[0,1,0],[0,0,0],[0,0,1],[1,0,0],[1,1,0],[1,0,0],[1,0,1],[0,1,0],[1,1,0],[0,1,0],[0,1,1],[0,0,1],[1,0,1],[0,0,1],[0,1,1],[1,0,1],[1,1,1],[1,1,0],[1,1,1],[0,1,1],[1,1,1]],st=["attribute vec3 previous;","attribute vec3 next;","attribute float side;","uniform vec2 win_size;","uniform float linewidth;","varying vec3 vcolor;","void main() {","  vcolor = color;","  mat4 mat = projectionMatrix * modelViewMatrix;","  vec2 dir1 = (mat * vec4(next - position, 0.0)).xy * win_size;","  float len = length(dir1);","  if (len > 0.0) dir1 /= len;","  vec2 dir2 = (mat * vec4(position - previous, 0.0)).xy * win_size;","  len = length(dir2);","  dir2 = len > 0.0 ? dir2 / len : dir1;","  vec2 tang = normalize(dir1 + dir2);","  vec2 normal = vec2(-tang.y, tang.x);","  float outer = side * dot(dir2, normal);","  float angle_factor = max(dot(tang, dir2), outer > 0.0 ? 0.5 : 0.1);","  gl_Position = mat * vec4(position, 1.0);","  gl_Position.xy += side * linewidth / angle_factor * normal / win_size;","}"].join("\n"),at=["attribute vec3 other;","attribute float side;","uniform vec2 win_size;","uniform float linewidth;","varying vec3 vcolor;","void main() {","  vcolor = color;","  mat4 mat = projectionMatrix * modelViewMatrix;","  vec2 dir = normalize((mat * vec4(position - other, 0.0)).xy);","  vec2 normal = vec2(-dir.y, dir.x);","  gl_Position = mat * vec4(position, 1.0);","  gl_Position.xy += side * linewidth * normal / win_size;","}"].join("\n"),lt=["#include <fog_pars_fragment>","varying vec3 vcolor;","void main() {","  gl_FragColor = vec4(vcolor, 1.0);","#include <fog_fragment>","}"].join("\n"),ht=["uniform float shift;","varying vec3 vcolor;","void main() {","  vcolor = color;","  vec3 pos = position + shift * normalize(normal);","  gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);","}"].join("\n"),ct=["#include <fog_pars_fragment>","varying vec3 vcolor;","void main() {","  gl_FragColor = vec4(vcolor, 1.0);","#include <fog_fragment>","}"].join("\n"),dt=["uniform vec3 ucolor;","uniform vec3 fogColor;","varying vec4 vcolor;","void main() {","  vec2 scale = vec2(projectionMatrix[0][0], projectionMatrix[1][1]);","  float z = position.z;","  float fogFactor = (z > 0.5 ? 0.2 : 0.7);","  float alpha = 0.8 * smoothstep(z > 1.5 ? -10.0 : 0.01, 0.1, scale.y);","  vcolor = vec4(mix(ucolor, fogColor, fogFactor), alpha);","  gl_Position = vec4(position.xy * scale, -0.99, 1.0);","}"].join("\n"),ut=["varying vec4 vcolor;","void main() {","  gl_FragColor = vcolor;","}"].join("\n"),ft=["uniform float size;","varying vec3 vcolor;","void main() {","  vcolor = color;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  gl_PointSize = size;","}"].join("\n"),_t=["#include <fog_pars_fragment>","varying vec3 vcolor;","void main() {","  vec2 diff = gl_PointCoord - vec2(0.5, 0.5);","  if (dot(diff, diff) >= 0.25) discard;","  gl_FragColor = vec4(vcolor, 1.0);","#include <fog_fragment>","}"].join("\n"),pt=new e.Matrix4,mt=new e.Ray,vt=["uniform vec2 canvas_size;","uniform vec2 win_size;","varying vec2 vUv;","void main() {","  vUv = uv;","  vec2 rel_offset = vec2(0.02, -0.3);","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  gl_Position.xy += (uv + rel_offset) * 2.0 * canvas_size / win_size;","  gl_Position.z += 1.0 * projectionMatrix[2][2];","}"].join("\n"),gt=["#include <fog_pars_fragment>","varying vec2 vUv;","uniform sampler2D map;","void main() {","  gl_FragColor = texture2D(map, vUv);","#include <fog_fragment>","}"].join("\n"),yt=[{name:"coot dark",bg:0,fg:16777215,map_den:3367602,map_pos:2719785,map_neg:9121326,center:13211568,H:8750469,C:11776768,N:8301307,O:15878532,S:4259648,MG:12632256,P:16760896,CL:10551136,CA:16777215,MN:16748736,FE:10498048,NI:65408,def:10526880},{name:"solarized dark",bg:11062,fg:16643811,map_den:2526162,map_pos:8755456,map_neg:13842050,center:16643811,H:5795445,C:9675169,N:7107012,O:13323030,S:11897088,def:15657173},{name:"solarized light",bg:16643811,fg:11062,map_den:2526162,map_pos:8755456,map_neg:13842050,center:11062,H:9675169,C:5795445,N:7107012,O:13323030,S:11897088,def:472642},{name:"coot light",bg:16777215,fg:0,map_den:3367602,map_pos:2719785,map_neg:9121326,center:13092713,H:10066329,C:11101284,N:1855923,O:12793961,S:10386237,def:8421504}],bt=1,wt={NONE:-1,ROTATE:0,PAN:1,ZOOM:2,PAN_ZOOM:3,SLAB:4,ROLL:5,AUTO_ROTATE:6,GO:7},xt=function(t,i){function o(i){var o=new e.Quaternion;o.setFromUnitVectors(h,l),i.applyQuaternion(o),t.up.applyQuaternion(o),h.applyQuaternion(o),l.copy(h)}function r(e){var o=d.x-c.x,r=d.y-c.y;return a===wt.ZOOM?t.zoom/=1-o+r:a===wt.SLAB?i.addScaledVector(e,-5/e.length()*r):a===wt.ROLL&&t.up.applyAxisAngle(e,.05*(o-r)),c.copy(d),a===wt.SLAB?10*o:null}function n(e){var o=p.x-_.x,r=p.y-_.y;o*=.5*(t.right-t.left)/t.zoom,r*=.5*(t.bottom-t.top)/t.zoom;var n=e.clone().cross(t.up).setLength(o);n.addScaledVector(t.up,r/t.up.length()),t.position.add(n),i.add(n),_.copy(p)}function s(e){l.copy(e).normalize();var i=Date.now(),o=null!==g?i-g:16.7,r=18e-6*o*bt;g=i,v===!0?r=-r:v!==!1&&(v+=.02,r=4e-5*bt*Math.cos(v)),h.crossVectors(t.up,e).multiplyScalar(r).add(l)}var a=wt.NONE,l=new e.Vector3,h=new e.Vector3,c=new e.Vector2,d=new e.Vector2,u=0,f=0,_=new e.Vector2,p=new e.Vector2,m=!0,v=null,g=null,y=null;this.slab_width=[2.5,7.5],this.toggle_auto=function(t){a===wt.AUTO_ROTATE&&typeof t==typeof v?a=wt.NONE:(a=wt.AUTO_ROTATE,g=null,v=t)},this.is_going=function(){return a===wt.GO},this.is_moving=function(){return a!==wt.NONE},this.update=function(){var e=!1,v=t.position.clone().sub(i);if(a===wt.AUTO_ROTATE&&s(v),l.equals(h)||(o(v),e=!0),f!==u&&(t.zoom*=f/u,u=f,e=!0),!d.equals(c)){var g=r(v);g&&(this.slab_width[0]=Math.max(this.slab_width[0]+g,.01),this.slab_width[1]=Math.max(this.slab_width[1]+g,.01)),e=!0}return p.equals(_)||(n(v),m=!0,e=!0),t.position.addVectors(i,v),a===wt.GO&&y&&(y(),e=!0),t.lookAt(i),e},this.start=function(t,e,i,o){switch(a!==wt.NONE&&a!==wt.AUTO_ROTATE||(a=t),this.move(e,i,o),a){case wt.ROTATE:l.copy(h);break;case wt.ZOOM:case wt.SLAB:case wt.ROLL:c.copy(d);break;case wt.PAN:_.copy(p),m=!1;break;case wt.PAN_ZOOM:u=f,_.copy(p)}},this.move=function(e,o,r){switch(a){case wt.ROTATE:var n=H(e,o),s=t.position.clone().sub(i);h.crossVectors(t.up,s).setLength(n[0]),h.addScaledVector(t.up,n[1]/t.up.length()),h.addScaledVector(s,n[2]/s.length());break;case wt.ZOOM:case wt.SLAB:case wt.ROLL:d.set(e,o);break;case wt.PAN:p.set(e,o);break;case wt.PAN_ZOOM:p.set(e,o),f=r}},this.stop=function(){var t=null;return a!==wt.PAN||m||(t=_),a=wt.NONE,l.copy(h),u=f,_.copy(p),t},this.go_to=function(o,r,n,s){if(o instanceof Array&&(o=new e.Vector3(o[0],o[1],o[2])),o&&!(o.distanceToSquared(i)<.1)||r&&!(r.distanceToSquared(t.position)<.1)||n&&!(n.distanceToSquared(t.up)<.1)){a=wt.GO,s=s||60/bt;for(var l=[],h=0,c=1;c<=s;++c){var d=c/s;d=d<.5?2*d*d:-2*d*(d-2)-1,l.push((d-h)/(1-h)),h=d}y=function(){var e=l.shift();o&&(r||t.position.sub(i),i.lerp(o,e),r||t.position.add(i)),r&&t.position.lerp(r,e),n&&t.up.lerp(n,e),0===l.length&&(a=wt.NONE,y=null)}}}},zt=["element","B-factor","occupancy","index","chain"],At=["lines","trace","ribbon"],Mt=["marching cubes","squarish"],Et=["normal","simplistic"],Ct=["bold 14px","14px","16px","bold 16px"];G.prototype.get_visible_atoms=function(){var t=this.model.atoms;if(this.conf.hydrogens||!this.model.has_hydrogens)return t;for(var e=[],i=0;i<t.length;i++)"H"!==t[i].element&&e.push(t[i]);return e},G.prototype.add_bonds=function(t,i){for(var o=this.get_visible_atoms(),r=t?"element":this.conf.color_aim,n=K(r,o,this.conf.colors),s=[],a=[],l={hydrogens:this.conf.hydrogens,ligands_only:t,balls:"ball&stick"===this.conf.render_style},h=0;h<o.length;h++){var c=o[h],d=n[h];if(!t||c.is_ligand)if(0!==c.bonds.length||l.balls)for(var u=0;u<c.bonds.length;u++){var f=this.model.atoms[c.bonds[u]];if((l.hydrogens||"H"!==f.element)&&(!l.ligands_only||f.is_ligand)){var _=c.midpoint(f),p=new e.Vector3(_[0],_[1],_[2]),m=new e.Vector3(c.xyz[0],c.xyz[1],c.xyz[2]);if(l.balls){var v=m.distanceTo(p)/i;m.lerp(p,v)}s.push(m,p),a.push(d,d)}}else{B(s,c.xyz,.7);for(var g=0;g<6;g++)a.push(d)}}var y=N(this.conf.bond_line,this.win_size),b="simplistic"===this.conf.line_style,w=k({gl_lines:b,linewidth:y,win_size:this.win_size,segments:!0});this.atomic_objects.push(T(w,s,a)),l.balls?this.atomic_objects.push(P(o,n,i)):b||t||this.atomic_objects.push(P(o,n,y))},G.prototype.add_trace=function(){for(var t=this.model.extract_trace(),e=[].concat.apply([],t),i=K(this.conf.color_aim,e,this.conf.colors),o=k({gl_lines:"simplistic"===this.conf.line_style,linewidth:N(this.conf.bond_line,this.win_size),win_size:this.win_size}),r=0,n=0;n<t.length;n++){var s=t[n],a=i.slice(r,r+s.length);r+=s.length;var l=F(o,s,a);this.atomic_objects.push(l)}},G.prototype.add_ribbon=function(t){for(var e=this.model.extract_trace(),i=this.model.get_residues(),o=[].concat.apply([],e),r=K(this.conf.color_aim,o,this.conf.colors),n=0,s=0;s<e.length;s++){for(var a=e[s],l=[],h=[0,0,0],c=0;c<a.length;c++){var d=i[a[c].resid()],u=this.model.calculate_tangent_vector(d);u[0]*h[0]+u[1]*h[1]+u[2]*h[2]<0&&(u[0]=-u[0],u[1]=-u[1],u[2]=-u[2]),l.push(u),h=u}var f=r.slice(n,n+a.length);n+=a.length;var _=A(a,f,l,t);this.atomic_objects.push(_)}},Y.prototype.pick_atom=function(t,e){var i=this.active_model_bag;if(null!==i){this.raycaster.setFromCamera(t,e),this.raycaster.near=e.near,this.raycaster.far=e.far-.15*(e.far-e.near),this.raycaster.linePrecision=.3;var o=this.raycaster.intersectObjects(i.atomic_objects);if(o.length<1)return null;o.sort(function(t){return t.line_dist||1/0});var r=o[0].point;return i.model.get_nearest_atom(r.x,r.y,r.z)}},Y.prototype.set_colors=function(t){function i(t){return new e.Color(t)}if(null==t)t=this.ColorSchemes[0];else if("number"==typeof t)t=this.ColorSchemes[t%this.ColorSchemes.length];else if("string"==typeof t)for(var o=0;o!==this.ColorSchemes.length;o++)if(this.ColorSchemes[o].name===t){t=this.ColorSchemes[o];break}if(void 0!==t.bg){if("number"==typeof t.bg)for(var r in t)"name"!==r&&(t[r]=t[r]instanceof Array?t[r].map(i):i(t[r]));this.decor.zoom_grid.color_value.set(t.fg),this.redraw_all()}},Y.prototype.relX=function(t){return 2*(t.pageX-this.window_offset[0])/this.window_size[0]-1},Y.prototype.relY=function(t){return 1-2*(t.pageY-this.window_offset[1])/this.window_size[1]},Y.prototype.hud=function(t,e){if("undefined"!=typeof document){var i=this.hud_el;if(i){void 0!==t?"HTML"===e?i.innerHTML=t:i.textContent=t:i.innerHTML=this.initial_hud_html;var o="ERR"===e;i.style["background-color"]=o?"#b00":this.initial_hud_bg,o&&console.log("ERR: "+t)}else console.log("hud: "+t)}},Y.prototype.redraw_center=function(){this.target.distanceToSquared(this.last_ctr)>1e-4&&(this.last_ctr.copy(this.target),this.mark&&this.scene.remove(this.mark),this.mark=_(.1,this.target,{color:this.config.colors.center,linewidth:2,win_size:this.window_size}),this.scene.add(this.mark))},Y.prototype.redraw_maps=function(t){this.redraw_center();for(var e=0;e<this.map_bags.length;e++){var i=this.map_bags[e];(t||this.target.distanceToSquared(i.block_ctr)>.01)&&this.redraw_map(i)}},Y.prototype.remove_and_dispose=function(t,e){e||this.scene.remove(t),t.geometry&&t.geometry.dispose(),t.material&&(t.material.uniforms&&t.material.uniforms.map&&t.material.uniforms.map.value.dispose(),t.material.dispose());for(var i=0;i<t.children.length;i++)this.remove_and_dispose(t.children[i])},Y.prototype.clear_el_objects=function(t){for(var e=0;e<t.el_objects.length;e++)this.remove_and_dispose(t.el_objects[e]);t.el_objects=[]},Y.prototype.clear_atomic_objects=function(t){if(t.atomic_objects)for(var e=0;e<t.atomic_objects.length;e++)this.remove_and_dispose(t.atomic_objects[e]);t.atomic_objects=null},Y.prototype.set_atomic_objects=function(t){switch(t.atomic_objects=[],t.conf.render_style){case"lines":t.add_bonds();break;case"ball&stick":var e=this.camera.projectionMatrix.elements[5],i=Math.max(1,200*e);t.add_bonds(!1,i);break;case"trace":t.add_trace(),t.add_bonds(!0);break;case"ribbon":t.add_ribbon(8),t.add_bonds(!0)}for(var o=0;o<t.atomic_objects.length;o++)this.scene.add(t.atomic_objects[o])},Y.prototype.toggle_label=function(t,e){if(t){var i=t.short_label(),o=i,r=o in this.labels;if(void 0===e&&(e=!r),e){if(r)return;var n=V(i,{pos:t.xyz,font:this.config.label_font,color:"#"+this.config.colors.fg.getHexString(),win_size:this.window_size});if(!n)return;this.labels[o]=n,this.scene.add(n)}else{if(!r)return;this.remove_and_dispose(this.labels[o]),delete this.labels[o]}}},Y.prototype.redraw_labels=function(){for(var t in this.labels){var e=t;this.labels[t].remake(e,{font:this.config.label_font,color:"#"+this.config.colors.fg.getHexString()})}},Y.prototype.toggle_map_visibility=function(t){"number"==typeof t&&(t=this.map_bags[t]),t.visible=!t.visible,this.redraw_map(t),this.request_render()},Y.prototype.redraw_map=function(t){this.clear_el_objects(t),t.visible&&(t.map.block=null,this.add_el_objects(t))},Y.prototype.toggle_model_visibility=function(t){t=t||this.active_model_bag,t.visible=!t.visible,this.redraw_model(t),this.request_render()},Y.prototype.redraw_model=function(t){this.clear_atomic_objects(t),t.visible&&this.set_atomic_objects(t)},Y.prototype.redraw_models=function(){for(var t=0;t<this.model_bags.length;t++)this.redraw_model(this.model_bags[t])},Y.prototype.add_el_objects=function(t){if(t.visible&&!(this.config.map_radius<=0)){t.map.block||(t.block_ctr.copy(this.target),t.map.extract_block(this.config.map_radius,[this.target.x,this.target.y,this.target.z]));for(var e=0;e<t.types.length;e++){var i=t.types[e],o=("map_neg"===i?-1:1)*t.isolevel,r=t.map.isomesh_in_block(o,this.config.map_style),n=M(r,{color:this.config.colors[i],linewidth:this.config.map_line});t.el_objects.push(n),this.scene.add(n)}}},Y.prototype.change_isolevel_by=function(t,e){if(!(t>=this.map_bags.length)){var i=this.map_bags[t];i.isolevel+=e,this.clear_el_objects(i),this.add_el_objects(i);var o=i.map.abs_level(i.isolevel),r=o.toFixed(4),n=this.tied_viewer;if(n&&t<n.map_bags.length){var s=n.map_bags[t];s.isolevel=i.isolevel,r+=" / "+s.map.abs_level(s.isolevel).toFixed(4),n.clear_el_objects(s),n.add_el_objects(s)}this.hud("map "+(t+1)+" level =  "+r+" e/ ("+i.isolevel.toFixed(2)+" rmsd)")}},Y.prototype.change_map_radius=function(t){var e=40,i=this.config;i.map_radius=Math.min(Math.max(i.map_radius+t,0),e);var o='map "radius": '+i.map_radius;i.map_radius===e?o+=" (max)":0===i.map_radius&&(o+=" (hidden maps)"),this.hud(o),this.redraw_maps(!0)},Y.prototype.change_slab_width_by=function(t){var e=this.controls.slab_width;e[0]=Math.max(e[0]+t,.01),e[1]=Math.max(e[1]+t,.01),this.update_camera(),this.hud("clip width: "+(this.camera.far-this.camera.near).toPrecision(3))},Y.prototype.change_zoom_by_factor=function(t){this.camera.zoom*=t,this.update_camera(),this.hud("zoom: "+this.camera.zoom.toPrecision(3))},Y.prototype.change_bond_line=function(t){this.config.bond_line=Math.max(this.config.bond_line+t,.1),this.redraw_models(),this.hud("bond width: "+N(this.config.bond_line,this.window_size).toFixed(1))},Y.prototype.change_map_line=function(t){this.config.map_line=Math.max(this.config.map_line+t,.1),this.redraw_maps(!0),this.hud("wireframe width: "+this.config.map_line.toFixed(1))},Y.prototype.toggle_full_screen=function(){var t=document;if(t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement){var e=t.exitFullscreen||t.webkitExitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen;e&&e.call(t)}else{var i=this.container,o=i.requestFullscreen||i.webkitRequestFullscreen||i.mozRequestFullScreen||i.msRequestFullscreen;o&&o.call(i)}},Y.prototype.toggle_cell_box=function(){if(this.decor.cell_box)this.scene.remove(this.decor.cell_box),this.decor.cell_box=null;else{var t=null;this.model_bags.length>0&&(t=this.model_bags[0].model.unit_cell),!t&&this.map_bags.length>0&&(t=this.map_bags[0].map.unit_cell),t&&(this.decor.cell_box=p(t.orthogonalize,{color:this.config.colors.fg}),this.scene.add(this.decor.cell_box))}},Y.prototype.shift_clip=function(t){var e=this.camera.position.clone().sub(this.target);e.multiplyScalar(t/e.length()),this.target.add(e),this.camera.position.add(e),this.update_camera(),this.redraw_maps(),this.hud("clip shifted by ["+I(e,2).join(" ")+"]")},Y.prototype.go_to_nearest_Ca=function(){var t=this.target;if(null!==this.active_model_bag){var e=this.active_model_bag.model.get_nearest_atom(t.x,t.y,t.z,"CA");e?this.select_atom(e):this.hud("no nearby CA")}},Y.prototype.permalink=function(){"undefined"!=typeof window&&(window.location.hash="#xyz="+I(this.target,1).join(",")+"&eye="+I(this.camera.position,1).join(",")+"&zoom="+this.camera.zoom.toFixed(0),this.hud("copy URL from the location bar"))},Y.prototype.redraw_all=function(){this.renderer&&(this.scene.fog.color=this.config.colors.bg,this.renderer&&this.renderer.setClearColor(this.config.colors.bg,1),this.redraw_models(),this.redraw_maps(!0),this.redraw_labels())},Y.prototype.toggle_help=function(t){t&&(t.style.display="block"===t.style.display?"none":"block",""===t.innerHTML&&(t.innerHTML=[this.MOUSE_HELP,this.KEYBOARD_HELP,this.ABOUT_HELP].join("\n\n")))},Y.prototype.MOUSE_HELP=["<b>mouse:</b>","Left = rotate","Middle or Ctrl+Left = pan","Right = zoom","Ctrl+Right = clipping","Ctrl+Shift+Right = roll","Wheel =  level","Shift+Wheel = diff map "].join("\n"),Y.prototype.KEYBOARD_HELP=["<b>keyboard:</b>","H = toggle help","T = representation","C = coloring","B = bg color","Q = label font","+/- = sigma level","]/[ = map radius","D/F = clip width","numpad 3/. = move clip","M/N = zoom","U = unitcell box","Y = hydrogens","R = center view","W = wireframe style","I = spin","K = rock","Home/End = bond width","\\ = bond caps","P = nearest C","Shift+P = permalink","(Shift+)space = next res.","Shift+F = full screen"].join("\n"),Y.prototype.ABOUT_HELP='<a href="https://uglymol.github.io">about uglymol</a>',Y.prototype.select_next=function(t,e,i,o){var r=i.indexOf(this.config[e]),n=i.length,s=(r+(o?n-1:1))%n;this.config[e]=i[s];for(var a=t+":",l=0;l<n;l++){var h=l===s?"u":"s",c=i[l].name||i[l];a+=" <"+h+">"+c+"</"+h+">"}this.hud(a,"HTML")},Y.prototype.keydown=function(t){var e=this.key_bindings[t.keyCode];e?e.bind(this)(t):(e===!1&&t.preventDefault(),this.help_el&&this.hud("Nothing here. Press H for help.")),this.request_render()},Y.prototype.set_common_key_bindings=function(){var t=new Array(256);t[36]=function(t){t.ctrlKey?this.change_map_line(.1):this.change_bond_line(.2)},t[35]=function(t){t.ctrlKey?this.change_map_line(-.1):this.change_bond_line(-.2)},t[66]=function(t){this.select_next("color scheme","colors",this.ColorSchemes,t.shiftKey),this.set_colors(this.config.colors)},t[67]=function(t){this.select_next("coloring by","color_aim",zt,t.shiftKey),this.redraw_models()},t[68]=function(){this.change_slab_width_by(-.1)},t[70]=function(t){t.shiftKey?this.toggle_full_screen():this.change_slab_width_by(.1)},t[72]=function(){this.toggle_help(this.help_el)},t[73]=function(t){this.hud("toggled spinning"),this.controls.toggle_auto(t.shiftKey)},t[75]=function(){this.hud("toggled rocking"),this.controls.toggle_auto(0)},t[77]=function(t){this.change_zoom_by_factor(t.shiftKey?1.2:1.03)},t[78]=function(t){this.change_zoom_by_factor(1/(t.shiftKey?1.2:1.03))},t[81]=function(t){this.select_next("label font","label_font",Ct,t.shiftKey),this.redraw_labels()},t[82]=function(t){t.shiftKey?(this.hud("redraw!"),this.redraw_all()):(this.hud("recentered"),this.recenter())},t[85]=function(){this.hud("toggled unit cell box"),this.toggle_cell_box()},t[87]=function(t){this.select_next("map style","map_style",Mt,t.shiftKey),this.redraw_maps(!0)},t[107]=t[61]=t[187]=function(t){this.change_isolevel_by(t.shiftKey?1:0,.1)},t[109]=t[173]=t[189]=function(t){this.change_isolevel_by(t.shiftKey?1:0,-.1)},t[219]=function(){this.change_map_radius(-2)},t[221]=function(){this.change_map_radius(2)},t[220]=function(t){this.select_next("bond lines","line_style",Et,t.shiftKey),this.redraw_models()},t[51]=t[99]=function(){this.shift_clip(1)},t[108]=t[110]=function(){this.shift_clip(-1)},t[16]=t[17]=t[18]=t[225]=function(){},t[191]=t[222]=!1,this.key_bindings=t},Y.prototype.set_real_space_key_bindings=function(){var t=this.key_bindings;t[32]=function(t){this.center_next_residue(t.shiftKey)},t[80]=function(t){t.shiftKey?this.permalink():this.go_to_nearest_Ca()},t[84]=function(t){this.select_next("rendering as","render_style",At,t.shiftKey),this.redraw_models()},t[89]=function(t){this.config.hydrogens=!this.config.hydrogens,this.hud((this.config.hydrogens?"show":"hide")+" hydrogens (if any)"),this.redraw_models()}},Y.prototype.mousedown=function(t){t.stopPropagation(),document.addEventListener("mouseup",this.mouseup),document.addEventListener("mousemove",this.mousemove);var e=wt.NONE;1===t.button||0===t.button&&t.ctrlKey?e=wt.PAN:0===t.button?(t.shiftKey&&this.dblclick(t),e=wt.ROTATE):2===t.button&&(t.ctrlKey?e=t.shiftKey?wt.ROLL:wt.SLAB:(this.decor.zoom_grid.visible=!0,e=wt.ZOOM)),this.controls.start(e,this.relX(t),this.relY(t)),this.request_render()},Y.prototype.dblclick=function(t){if(0===t.button){this.decor.selection&&(this.remove_and_dispose(this.decor.selection),this.decor.selection=null);var i=new e.Vector2(this.relX(t),this.relY(t)),o=this.pick_atom(i,this.camera);if(o){this.hud(o.long_label()),this.toggle_label(o);var r=this.config.colors[o.element]||this.config.colors.def,n=2.5*N(this.config.bond_line,this.window_size);this.decor.selection=P([o],[r],n),this.scene.add(this.decor.selection)}else this.hud();this.request_render()}},Y.prototype.touchstart=function(t){var e=t.touches;if(1===e.length)this.controls.start(wt.ROTATE,this.relX(e[0]),this.relY(e[0]));else{var i=X(t);this.controls.start(wt.PAN_ZOOM,this.relX(i),this.relY(i),i.dist)}this.request_render()},Y.prototype.touchmove=function(t){t.preventDefault(),t.stopPropagation();var e=t.touches;if(1===e.length)this.controls.move(this.relX(e[0]),this.relY(e[0]));else{var i=X(t);this.controls.move(this.relX(i),this.relY(i),i.dist)}},Y.prototype.touchend=function(){this.controls.stop(),this.redraw_maps()},Y.prototype.mousewheel=function(t){t.preventDefault(),t.stopPropagation();var e=t.wheelDelta||-2*(t.detail||0);this.mousewheel_action(e,t),this.request_render()},Y.prototype.mousewheel_action=function(t,e){this.change_isolevel_by(e.shiftKey?1:0,5e-4*t)},Y.prototype.resize=function(){var t=this.container,e=t.clientWidth,i=t.clientHeight;this.window_offset[0]=t.offsetLeft,this.window_offset[1]=t.offsetTop,this.camera.left=-e,this.camera.right=e,this.camera.top=i,this.camera.bottom=-i,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,i),e===this.window_size[0]&&i===this.window_size[1]||(this.window_size[0]=e,this.window_size[1]=i,this.redraw_models()),this.request_render()},Y.prototype.recenter=function(t,i,o){var r,n=this.active_model_bag;if(null!=t&&null==i&&null!==n){t=new e.Vector3(t[0],t[1],t[2]);var s=n.model.get_center(),a=new e.Vector3(t[0]-s[0],t[1]-s[1],t[2]-s[2]);a.setLength(100),r=a.y<90?new e.Vector3(0,1,0):new e.Vector3(1,0,0),r.projectOnPlane(a).normalize(),i=a.add(t)}else if(t=t||(n?n.model.get_center():[0,0,0]),null!=i)i=new e.Vector3(i[0],i[1],i[2]),r=null;else{var l=this.default_camera_pos;i=new e.Vector3(t[0]+l[0],t[1]+l[1],t[2]+l[2]),r=e.Object3D.DefaultUp}this.controls.go_to(t,i,r,o)},Y.prototype.center_next_residue=function(t){if(this.active_model_bag){var e=this.active_model_bag.model.next_residue(this.selected_atom,t);e&&this.select_atom(e)}},Y.prototype.select_atom=function(t,e){e=e||{},this.hud("-> "+t.long_label());var i=e.steps||30/bt;this.controls.go_to(t.xyz,null,null,i),this.toggle_label(this.selected_atom),this.selected_atom=t,this.toggle_label(t)},Y.prototype.update_camera=function(){var t=this.camera.position.distanceTo(this.target),e=this.controls.slab_width,i=3===e.length?e[2]:this.camera.zoom;this.camera.near=t*(1-e[0]/i),this.camera.far=t*(1+e[1]/i),this.camera.updateProjectionMatrix()},Y.prototype.render=function(){if(this.scheduled=!0,null!==this.renderer){this.controls.update()&&this.update_camera();var t=this.tied_viewer;this.controls.is_going()||(this.redraw_maps(),t&&!t.scheduled&&t.redraw_maps()),this.renderer.render(this.scene,this.camera),t&&!t.scheduled&&t.renderer.render(t.scene,t.camera),this.nav&&this.nav.renderer.render(this.nav.scene,this.camera),this.scheduled=!1,this.controls.is_moving()&&this.request_render(),this.stats&&this.stats.update()}},Y.prototype.request_render=function(){"undefined"==typeof window||this.scheduled||(this.scheduled=!0,window.requestAnimationFrame(this.render.bind(this)))},Y.prototype.set_model=function(t){var e=new G(t,this.config,this.window_size);this.model_bags.push(e),this.set_atomic_objects(e),this.active_model_bag=e,this.request_render()},Y.prototype.add_map=function(t,e){var i=new D(t,e);this.map_bags.push(i),this.add_el_objects(i),this.request_render()},Y.prototype.load_file=function(t,e,i,o){if(null!==this.renderer){var r=new XMLHttpRequest;r.open("GET",t,!0),e?r.responseType="arraybuffer":r.overrideMimeType("text/plain");var n=this;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status&&null!==r.response)try{i(r)}catch(e){n.hud("Error: "+e.message+"\nin "+t,"ERR")}else n.hud("Failed to fetch "+t,"ERR")},o&&r.addEventListener("progress",function(e){if(e.lengthComputable&&e.loaded&&e.total){var i=t.split("/").pop();n.hud("loading "+i+" ... "+(e.loaded>>10)+" / "+(e.total>>10)+" kB")}});try{r.send(null)}catch(e){n.hud("loading "+t+" failed:\n"+e,"ERR")}}},Y.prototype.set_view=function(t){var e=W();e.zoom&&(this.camera.zoom=e.zoom),this.recenter(e.xyz||t.center,e.eye,1)},Y.prototype.load_pdb=function(t,e){e=e||{};var i=this;this.load_file(t,!1,function(t){var r=new o;r.from_pdb(t.responseText),i.set_model(r),i.set_view(e),e.callback&&e.callback()})},Y.prototype.load_map=function(t,e,i,o,r){if("ccp4"!==i&&"dsn6"!==i)throw Error("Unknown map filetype.");var n=this;this.load_file(t,!0,function(t){var r=new u;"ccp4"===i?r.from_ccp4(t.response,!0):r.from_dsn6(t.response),n.add_map(r,e),o&&o()},r)},Y.prototype.load_ccp4_maps=function(t,e,i){var o=this;this.load_map(t,!1,"ccp4",function(){o.load_map(e,!0,"ccp4",function(){o.hud(),i&&i()},!0)},!0)},Y.prototype.load_pdb_and_ccp4_maps=function(t,e,i,o){var r=this;this.load_pdb(t,{callback:function(){r.load_ccp4_maps(e,i,o)}})},Y.prototype.ColorSchemes=yt,Y.auto_speed=bt;var St=["all","indexed","not indexed"],kt=["three","two","none"];Z.prototype=Object.create(Y.prototype),Z.prototype.constructor=Z,Z.prototype.KEYBOARD_HELP=["<b>keyboard:</b>","H = toggle help","V = show (un)indexed","A = toggle axes","B = bg color","M/N = zoom","D/F = clip width","R = center view","Home/End = point size","Shift+P = permalink","Shift+F = full screen","/ = max resol.","/ = min resol."].join("\n"),Z.prototype.MOUSE_HELP=Y.prototype.MOUSE_HELP.split("\n").slice(0,-2).join("\n"),Z.prototype.set_reciprocal_key_bindings=function(){var t=this.key_bindings;t[65]=function(t){this.select_next("axes","show_axes",kt,t.shiftKey),this.set_axes()},t[80]=function(t){this.permalink()},t[86]=function(t){this.select_next("show","show_only",St,t.shiftKey);var e=this.points.material.uniforms.show_only,i={all:-2,indexed:0,"not indexed":-1};e.value=i[this.config.show_only]},t[36]=function(t){t.ctrlKey?this.change_map_line(.1):this.change_point_size(.5)},t[35]=function(t){t.ctrlKey?this.change_map_line(-.1):this.change_point_size(-.5)},t[51]=t[99]=function(){this.shift_clip(.1)},t[108]=t[110]=function(){this.shift_clip(-.1)},t[37]=function(){this.change_dmin(.05)},t[39]=function(){this.change_dmin(-.05)},t[38]=function(){this.change_dmax(.025)},t[40]=function(){this.change_dmax(-.025)}},Z.prototype.load_data=function(t,e){e=e||{};var i=this;this.load_file(t,!1,function(t){i.parse_data(t.responseText),i.set_axes(),i.set_points(),i.camera.zoom=.5*(i.camera.top-i.camera.bottom);
var o=1.01*i.max_dist;i.controls.slab_width=[o,o,100],i.set_view(e),e.callback&&e.callback()})},Z.prototype.parse_data=function(t){for(var e=t.split("\n").filter(function(t){return t.length>0&&"#"!==t[0]}),i=new Float32Array(3*e.length),o=[],r=0,n=0;n<e.length;n++){var s=e[n].split(",").map(Number),a=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];a>r&&(r=a);for(var l=0;l<3;l++)i[3*n+l]=s[l];o.push(s[3])}this.max_dist=Math.sqrt(r),this.d_min=1/this.max_dist,this.data={pos:i,lattice_ids:o}},Z.prototype.set_axes=function(){if(null!=this.axes&&(this.remove_and_dispose(this.axes),this.axes=null),"none"!==this.config.show_axes){var t=1.2*this.max_dist,e=[];B(e,[0,0,0],t);var i=this.config.colors.axes,o=[i[0],i[0],i[1],i[1],i[2],i[2]];"two"===this.config.show_axes&&(e.splice(4),o.splice(4));var r=k({win_size:this.window_size,linewidth:3,segments:!0});this.axes=T(r,e,o),this.scene.add(this.axes)}};var Ot=["attribute float group;","uniform float show_only;","uniform float r2_max;","uniform float r2_min;","uniform float size;","varying vec3 vcolor;","varying float vsel;","void main() {","  vcolor = color;","  bool sel = show_only == -2.0 || show_only == group;","  float r2 = dot(position, position);","  vsel = sel && r2_min <= r2 && r2 < r2_max ? 1.0 : 0.0;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  gl_PointSize = size;","}"].join("\n"),Lt=["varying vec3 vcolor;","varying float vsel;","void main() {","  vec2 diff = gl_PointCoord - vec2(0.5, 0.5);","  float dist_sq = 4.0 * dot(diff, diff);","  if (vsel == 0.0 || dist_sq >= 1.0) discard;","  gl_FragColor = vec4(vcolor, 1.0 - dist_sq * dist_sq * dist_sq);","}"].join("\n");Z.prototype.set_points=function(){if(null!=this.data){var t=this.data.pos,i=this.data.lattice_ids,o=new Float32Array(3*i.length);this.colorize_by_id(o,i);var r=new e.BufferGeometry;r.addAttribute("position",new e.BufferAttribute(t,3)),r.addAttribute("color",new e.BufferAttribute(o,3));var n=new Float32Array(i);r.addAttribute("group",new e.BufferAttribute(n,1));var s=new e.ShaderMaterial({uniforms:{size:{value:3},show_only:{value:-2},r2_max:{value:100},r2_min:{value:0}},vertexShader:Ot,fragmentShader:Lt,vertexColors:e.VertexColors});s.transparent=!0,this.points=new e.Points(r,s),this.scene.add(this.points),this.request_render()}},Z.prototype.colorize_by_id=function(t,e){for(var i=this.config.colors.lattices,o=0;o<e.length;o++){var r=i[(e[o]+1)%4];t[3*o]=r.r,t[3*o+1]=r.g,t[3*o+2]=r.b}},Z.prototype.redraw_center=function(){},Z.prototype.mousewheel_action=function(t,e){this.change_zoom_by_factor(1+5e-4*t)},Z.prototype.change_point_size=function(t){if(null!==this.points){var e=this.points.material.uniforms.size;e.value=Math.max(e.value+t,.5),this.hud("point size: "+e.value.toFixed(1))}},Z.prototype.change_dmin=function(t){if(null!=this.d_min){this.d_min=Math.max(this.d_min+t,.1);var e=this.d_max_inv>0?1/this.d_max_inv:null;null!==e&&this.d_min>e&&(this.d_min=e),this.points.material.uniforms.r2_max.value=1/(this.d_min*this.d_min);var i=null!==e?e.toFixed(2):"";this.hud("res. limit: "+i+" - "+this.d_min.toFixed(2)+"")}},Z.prototype.change_dmax=function(t){if(null!=this.d_min){var e=Math.min(this.d_max_inv+t,1/this.d_min);e<1e-6&&(e=0),this.d_max_inv=e,this.points.material.uniforms.r2_min.value=e*e;var i=e>0?(1/e).toFixed(2):"";this.hud("res. limit: "+i+" - "+this.d_min.toFixed(2)+"")}},Z.prototype.redraw_models=function(){this.points&&this.remove_and_dispose(this.points),this.set_points()},Z.prototype.ColorSchemes=[{name:"solarized dark",bg:11062,fg:16643811,lattices:[14430767,2793880,2526162,8755456,13842050,11897088,7107012,13323030],axes:[16755370,11206570,11184895]},{name:"solarized light",bg:16643811,fg:11062,lattices:[14430767,2793880,2526162,8755456,13842050,11897088,7107012,13323030],axes:[16755370,11206570,11184895]}],t.UnitCell=i,t.Model=o,t.isosurface=h,t.ElMap=u,t.makeCube=_,t.makeRgbBox=p,t.makeRibbon=A,t.makeChickenWire=M,t.makeGrid=E,t.makeLineMaterial=k,t.makeLine=F,t.makeLineSegments=T,t.makeWheels=P,t.makeLabel=V,t.addXyzCross=B,t.Viewer=Y,t.ReciprocalViewer=Z,Object.defineProperty(t,"__esModule",{value:!0})});